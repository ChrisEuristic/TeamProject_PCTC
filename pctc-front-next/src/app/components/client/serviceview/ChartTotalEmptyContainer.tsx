"use client";

import { Chart } from "chart.js/auto";
import { useEffect, useRef, useState } from "react";
import { ChartComponentProps } from "./ChartComponent";

export interface EmptyContainerChartComponentProps {
  title: string,
  legend: [string, string]
  data: number[]
  labels: string[];
  width?: number;
  height?: number;
}

const dummyRawData = {
  CKL: {
    PL20: 0,
    PL40: 0,
    PL45: 0,
    GP20: 25,
    GP40: 0,
    GP45: 0,
    OT20: 0,
    OT40: 0,
    OT45: 0,
    FL20: 1,
    FL40: 0,
    FL45: 0,
    HQ20: 0,
    HQ40: 7,
    HQ45: 0,
    DC20: 0,
    DC40: 0,
    DC45: 0,
  },
  CMA: {
    PL20: 0,
    PL40: 0,
    PL45: 0,
    GP20: 69,
    GP40: 0,
    GP45: 0,
    OT20: 0,
    OT40: 0,
    OT45: 0,
    FL20: 0,
    FL40: 0,
    FL45: 0,
    HQ20: 0,
    HQ40: 12,
    HQ45: 0,
    DC20: 0,
    DC40: 0,
    DC45: 0,
  },
  COS: {
    PL20: 0,
    PL40: 0,
    PL45: 0,
    GP20: 4,
    GP40: 0,
    GP45: 0,
    OT20: 0,
    OT40: 0,
    OT45: 0,
    FL20: 0,
    FL40: 0,
    FL45: 0,
    HQ20: 0,
    HQ40: 30,
    HQ45: 0,
    DC20: 0,
    DC40: 0,
    DC45: 0,
  },
  DJS: {
    PL20: 0,
    PL40: 0,
    PL45: 0,
    GP20: 6,
    GP40: 7,
    GP45: 0,
    OT20: 0,
    OT40: 0,
    OT45: 0,
    FL20: 0,
    FL40: 0,
    FL45: 0,
    HQ20: 0,
    HQ40: 158,
    HQ45: 0,
    DC20: 0,
    DC40: 0,
    DC45: 0,
  },
  DYS: {
    PL20: 0,
    PL40: 0,
    PL45: 0,
    GP20: 85,
    GP40: 0,
    GP45: 0,
    OT20: 0,
    OT40: 0,
    OT45: 0,
    FL20: 0,
    FL40: 0,
    FL45: 0,
    HQ20: 0,
    HQ40: 33,
    HQ45: 0,
    DC20: 0,
    DC40: 0,
    DC45: 0,
  },
  GFL: {
    PL20: 0,
    PL40: 0,
    PL45: 0,
    GP20: 0,
    GP40: 0,
    GP45: 0,
    OT20: 0,
    OT40: 0,
    OT45: 0,
    FL20: 0,
    FL40: 0,
    FL45: 0,
    HQ20: 0,
    HQ40: 2,
    HQ45: 0,
    DC20: 0,
    DC40: 0,
    DC45: 0,
  },
  HAD: {
    PL20: 0,
    PL40: 0,
    PL45: 0,
    GP20: 37,
    GP40: 1,
    GP45: 0,
    OT20: 0,
    OT40: 0,
    OT45: 0,
    FL20: 0,
    FL40: 0,
    FL45: 0,
    HQ20: 0,
    HQ40: 14,
    HQ45: 0,
    DC20: 0,
    DC40: 0,
    DC45: 0,
  },
  HAS: {
    PL20: 0,
    PL40: 0,
    PL45: 0,
    GP20: 172,
    GP40: 1,
    GP45: 0,
    OT20: 0,
    OT40: 0,
    OT45: 0,
    FL20: 0,
    FL40: 0,
    FL45: 0,
    HQ20: 0,
    HQ40: 165,
    HQ45: 0,
    DC20: 0,
    DC40: 0,
    DC45: 0,
  },
  HHS: {
    PL20: 0,
    PL40: 0,
    PL45: 0,
    GP20: 10,
    GP40: 0,
    GP45: 0,
    OT20: 0,
    OT40: 0,
    OT45: 0,
    FL20: 0,
    FL40: 0,
    FL45: 0,
    HQ20: 0,
    HQ40: 2,
    HQ45: 0,
    DC20: 0,
    DC40: 0,
    DC45: 0,
  },
  HMM: {
    PL20: 0,
    PL40: 0,
    PL45: 0,
    GP20: 9,
    GP40: 1,
    GP45: 0,
    OT20: 0,
    OT40: 0,
    OT45: 0,
    FL20: 0,
    FL40: 0,
    FL45: 0,
    HQ20: 0,
    HQ40: 25,
    HQ45: 0,
    DC20: 0,
    DC40: 0,
    DC45: 0,
  },
  HSL: {
    PL20: 0,
    PL40: 0,
    PL45: 0,
    GP20: 3,
    GP40: 0,
    GP45: 0,
    OT20: 0,
    OT40: 0,
    OT45: 0,
    FL20: 0,
    FL40: 0,
    FL45: 0,
    HQ20: 0,
    HQ40: 4,
    HQ45: 0,
    DC20: 0,
    DC40: 0,
    DC45: 0,
  },
  HXD: {
    PL20: 0,
    PL40: 0,
    PL45: 0,
    GP20: 4,
    GP40: 0,
    GP45: 0,
    OT20: 0,
    OT40: 0,
    OT45: 0,
    FL20: 0,
    FL40: 0,
    FL45: 0,
    HQ20: 0,
    HQ40: 8,
    HQ45: 0,
    DC20: 0,
    DC40: 0,
    DC45: 0,
  },
  KMD: {
    PL20: 0,
    PL40: 0,
    PL45: 0,
    GP20: 0,
    GP40: 0,
    GP45: 0,
    OT20: 0,
    OT40: 1,
    OT45: 0,
    FL20: 2,
    FL40: 0,
    FL45: 0,
    HQ20: 0,
    HQ40: 84,
    HQ45: 25,
    DC20: 0,
    DC40: 0,
    DC45: 0,
  },
  NSL: {
    PL20: 0,
    PL40: 0,
    PL45: 0,
    GP20: 61,
    GP40: 0,
    GP45: 0,
    OT20: 0,
    OT40: 0,
    OT45: 0,
    FL20: 0,
    FL40: 0,
    FL45: 0,
    HQ20: 0,
    HQ40: 12,
    HQ45: 0,
    DC20: 0,
    DC40: 0,
    DC45: 0,
  },
  PCL: {
    PL20: 0,
    PL40: 0,
    PL45: 0,
    GP20: 25,
    GP40: 11,
    GP45: 0,
    OT20: 0,
    OT40: 0,
    OT45: 0,
    FL20: 0,
    FL40: 0,
    FL45: 0,
    HQ20: 0,
    HQ40: 29,
    HQ45: 0,
    DC20: 0,
    DC40: 0,
    DC45: 0,
  },
  POL: {
    PL20: 0,
    PL40: 0,
    PL45: 0,
    GP20: 4,
    GP40: 0,
    GP45: 0,
    OT20: 0,
    OT40: 0,
    OT45: 0,
    FL20: 0,
    FL40: 0,
    FL45: 0,
    HQ20: 0,
    HQ40: 38,
    HQ45: 0,
    DC20: 0,
    DC40: 0,
    DC45: 0,
  },
  SKR: {
    PL20: 0,
    PL40: 0,
    PL45: 0,
    GP20: 153,
    GP40: 8,
    GP45: 0,
    OT20: 14,
    OT40: 0,
    OT45: 0,
    FL20: 3,
    FL40: 0,
    FL45: 0,
    HQ20: 0,
    HQ40: 176,
    HQ45: 0,
    DC20: 0,
    DC40: 0,
    DC45: 0,
  },
  SML: {
    PL20: 0,
    PL40: 0,
    PL45: 0,
    GP20: 0,
    GP40: 2,
    GP45: 0,
    OT20: 0,
    OT40: 0,
    OT45: 0,
    FL20: 0,
    FL40: 0,
    FL45: 0,
    HQ20: 0,
    HQ40: 9,
    HQ45: 0,
    DC20: 0,
    DC40: 0,
    DC45: 0,
  },
  TCL: {
    PL20: 0,
    PL40: 0,
    PL45: 0,
    GP20: 5,
    GP40: 0,
    GP45: 0,
    OT20: 0,
    OT40: 0,
    OT45: 0,
    FL20: 0,
    FL40: 0,
    FL45: 0,
    HQ20: 0,
    HQ40: 2,
    HQ45: 0,
    DC20: 0,
    DC40: 0,
    DC45: 0,
  },
  TJM: {
    PL20: 0,
    PL40: 0,
    PL45: 0,
    GP20: 23,
    GP40: 0,
    GP45: 0,
    OT20: 0,
    OT40: 0,
    OT45: 0,
    FL20: 0,
    FL40: 0,
    FL45: 0,
    HQ20: 0,
    HQ40: 4,
    HQ45: 0,
    DC20: 0,
    DC40: 0,
    DC45: 0,
  },
  TMS: {
    PL20: 0,
    PL40: 0,
    PL45: 0,
    GP20: 0,
    GP40: 0,
    GP45: 0,
    OT20: 0,
    OT40: 0,
    OT45: 0,
    FL20: 0,
    FL40: 0,
    FL45: 0,
    HQ20: 0,
    HQ40: 13,
    HQ45: 0,
    DC20: 0,
    DC40: 0,
    DC45: 0,
  },
  TSL: {
    PL20: 0,
    PL40: 0,
    PL45: 0,
    GP20: 0,
    GP40: 11,
    GP45: 0,
    OT20: 0,
    OT40: 0,
    OT45: 0,
    FL20: 0,
    FL40: 0,
    FL45: 0,
    HQ20: 0,
    HQ40: 0,
    HQ45: 0,
    DC20: 0,
    DC40: 0,
    DC45: 0,
  },
  WSL: {
    PL20: 0,
    PL40: 8,
    PL45: 0,
    GP20: 4,
    GP40: 4,
    GP45: 0,
    OT20: 0,
    OT40: 0,
    OT45: 0,
    FL20: 0,
    FL40: 0,
    FL45: 0,
    HQ20: 0,
    HQ40: 14,
    HQ45: 0,
    DC20: 0,
    DC40: 0,
    DC45: 0,
  },
  YML: {
    PL20: 0,
    PL40: 0,
    PL45: 0,
    GP20: 0,
    GP40: 0,
    GP45: 0,
    OT20: 0,
    OT40: 0,
    OT45: 0,
    FL20: 0,
    FL40: 0,
    FL45: 0,
    HQ20: 0,
    HQ40: 2,
    HQ45: 0,
    DC20: 3,
    DC40: 6,
    DC45: 0,
  },
  ZIM: {
    PL20: 0,
    PL40: 0,
    PL45: 0,
    GP20: 23,
    GP40: 6,
    GP45: 0,
    OT20: 0,
    OT40: 0,
    OT45: 0,
    FL20: 0,
    FL40: 0,
    FL45: 0,
    HQ20: 0,
    HQ40: 15,
    HQ45: 0,
    DC20: 0,
    DC40: 0,
    DC45: 0,
  },
};

let dummyData: any;

export default function ChartTotalEmptyContainer({
  title,
  legend,
  data,
  labels,
  width,
  height,
}: EmptyContainerChartComponentProps) {
  const chartRef = useRef<HTMLCanvasElement>(null);
  const detailChartRef = useRef<HTMLCanvasElement>(null);
  const [selectShipCompany, setSelectShipCompany] = useState<string>("");

  useEffect(() => {
    dummyData = JSON.parse(JSON.stringify(dummyRawData));
  }, []);

  useEffect(() => {
    if (chartRef.current) {
      const ctx = chartRef.current.getContext("2d");
      if (ctx) {
        new Chart(ctx, {
          type: "bar",
          data: {
            labels: labels,
            datasets: [
              {
                label: "선사별 공컨테이너",
                data: data,
                backgroundColor: "rgba(75, 192, 192, 0.6)",
              },
            ],
          },
          options: {
            responsive: true,
            scales: {
              x: {
                beginAtZero: true,
                title: {
                  display: true,
                  align: "end",
                  color: "#808080",
                  font: {
                    size: 12,
                  },
                  text: legend[0],
                },
              },
              y: {
                beginAtZero: true,
                title: {
                  display: true,
                  align: "end",
                  color: "#808080",
                  font: {
                    size: 12,
                  },
                  text: legend[1],
                },
              },
            },
            plugins: {
              legend: {
                position: "top",
              },
              title: {
                display: true,
                text: title,
                font: {
                  size: 30,
                  family: "'Gowun Dodum', 'Helvetica', 'Arial', sans-serif",
                },
              },
            },
            onClick: function (event, elements) {
              if (elements.length > 0) {
                setSelectShipCompany("");
                setTimeout(() => {
                  setSelectShipCompany(labels[elements[0].index]);
                }, 50);
              }
            },
          },
        });
      }
    }
  }, [data, labels, legend, title]);

  useEffect(() => {
    dummyData[selectShipCompany];
    if (detailChartRef.current) {
      const ctx = detailChartRef.current.getContext("2d");
      if (ctx) {
        new Chart(ctx, {
          type: "bar",
          data: {
            labels: [
              "PL20",
              "PL40",
              "PL45",
              "GP20",
              "GP40",
              "GP45",
              "OT20",
              "OT40",
              "OT45",
              "FL20",
              "FL40",
              "FL45",
              "HQ20",
              "HQ40",
              "HQ45",
              "DC20",
              "DC40",
              "DC45",
            ],
            datasets: [
              {
                label: "공컨테이너",
                data: [
                  "PL20",
                  "PL40",
                  "PL45",
                  "GP20",
                  "GP40",
                  "GP45",
                  "OT20",
                  "OT40",
                  "OT45",
                  "FL20",
                  "FL40",
                  "FL45",
                  "HQ20",
                  "HQ40",
                  "HQ45",
                  "DC20",
                  "DC40",
                  "DC45",
                ].map((container) => dummyData[selectShipCompany][container]),
                backgroundColor: "rgba(255, 150, 150, 0.6)",
              },
            ],
          },
          options: {
            responsive: true,
            scales: {
              x: {
                beginAtZero: true,
                title: {
                  display: true,
                  align: "end",
                  color: "#808080",
                  font: {
                    size: 12,
                  },
                  text: "컨테이너 종류",
                },
              },
              y: {
                beginAtZero: true,
                title: {
                  display: true,
                  align: "end",
                  color: "#808080",
                  font: {
                    size: 12,
                  },
                  text: legend[1],
                },
              },
            },
            plugins: {
              legend: {
                position: "top",
              },
              title: {
                display: true,
                text: `${selectShipCompany}사의 공컨테이너 수`,
                font: {
                  size: 30,
                  family: "'Gowun Dodum', 'Helvetica', 'Arial', sans-serif",
                },
              },
            },
          },
        });
      }
    }
  }, [selectShipCompany, data, labels, legend]);

  return (
    <>
      <div>
        <canvas ref={chartRef} />
      </div>
      {selectShipCompany === "" ? (
        <span></span>
      ) : (
        <div>
          <canvas ref={detailChartRef} />
        </div>
      )}
      <style jsx>{`
        div {
          border: solid 1px #141414;
          border-radius: 7px;
          padding: 1rem;
          display: flex;
          justify-content: center;
          width: ${width}vw;
          height: ${height}vh;
          margin-bottom: 1vh;
        }
        canvas {
          width: ${width}vw;
          height: ${height}vh;
        }
      `}</style>
    </>
  );
}
